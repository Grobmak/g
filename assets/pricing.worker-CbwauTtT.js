(function(){"use strict";const v={CURTAIN:"curtain",WALLPAPER:"wallpaper",WOODEN_BLIND:"wooden_blind",ROLLER_BLIND:"roller_blind",VERTICAL_BLIND:"vertical_blind",ALUMINUM_BLIND:"aluminum_blind",PARTITION:"partition",PLEATED_SCREEN:"pleated_screen",REMOVAL:"removal"},q={CURTAIN_MAIN:"curtain_main",CURTAIN_SHEER:"curtain_sheer",WALLPAPER:v.WALLPAPER},mt="marnthara.input.v6.4",G=1.19599,vt={name:"Marnthara Smart Quotation",address:"123/45 ‡∏ñ‡∏ô‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏ï‡∏≥‡∏ö‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø 10110",phone:"081-234-5678",taxId:"",logoUrl:"",baseVatRate:0,bankAccount:{bankName:"‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢",accountName:"‡∏ö‡∏à‡∏Å. ‡∏°‡πà‡∏≤‡∏ô‡∏ò‡∏≤‡∏£‡∏≤ ‡πÄ‡∏î‡∏Ñ‡∏Ñ‡∏≠‡∏£‡πå",accountNumber:"123-4-56789-0",branch:"‡πÄ‡∏ã‡πá‡∏ô‡∏ó‡∏£‡∏±‡∏•‡πÄ‡∏ß‡∏¥‡∏•‡∏î‡πå",isEnabled:!0},pdf:{paymentTerms:"‡∏°‡∏±‡∏î‡∏à‡∏≥ 50% ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô",priceValidity:"‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏ô‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ú‡∏• 30 ‡∏ß‡∏±‡∏ô",notes:["‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß (‡πÉ‡∏ô‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£)","‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á 1 ‡∏õ‡∏µ (‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ú‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó)"]}},Et={style_surcharge:{‡∏•‡∏≠‡∏ô:0,‡∏à‡∏µ‡∏ö:0,‡∏ï‡∏≤‡πÑ‡∏Å‡πà:0,‡∏û‡∏±‡∏ö:0,‡πÅ‡∏õ‡πä‡∏ö:0,‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå:500}},h=t=>{if(typeof t=="number")return Number.isFinite(t)?t:0;if(!t)return 0;const r=typeof t=="string"?t.replace(/,/g,""):String(t),o=parseFloat(r);return Number.isFinite(o)?o:0},K=t=>{let r;const o=new Set,n=(_,g)=>{const b=typeof _=="function"?_(r):_;if(!Object.is(b,r)){const I=r;r=g??(typeof b!="object"||b===null)?b:Object.assign({},r,b),o.forEach(A=>A(r,I))}},s=()=>r,i={setState:n,getState:s,getInitialState:()=>u,subscribe:_=>(o.add(_),()=>o.delete(_))},u=r=t(n,s,i);return i},Q=(t=>t?K(t):K);function Ct(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var x={exports:{}},f={};var V;function gt(){if(V)return f;V=1;var t=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),l=Symbol.for("react.context"),i=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),_=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),b=Symbol.for("react.activity"),I=Symbol.iterator;function A(e){return e===null||typeof e!="object"?null:(e=I&&e[I]||e["@@iterator"],typeof e=="function"?e:null)}var M={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,L={};function P(e,c,d){this.props=e,this.context=c,this.refs=L,this.updater=d||M}P.prototype.isReactComponent={},P.prototype.setState=function(e,c){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,c,"setState")},P.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function R(){}R.prototype=P.prototype;function w(e,c,d){this.props=e,this.context=c,this.refs=L,this.updater=d||M}var O=w.prototype=new R;O.constructor=w,m(O,P.prototype),O.isPureReactComponent=!0;var H=Array.isArray;function B(){}var E={H:null,A:null,T:null,S:null},ht=Object.prototype.hasOwnProperty;function W(e,c,d){var p=d.ref;return{$$typeof:t,type:e,key:c,ref:p!==void 0?p:null,props:d}}function Wt(e,c){return W(e.type,c,e.props)}function z(e){return typeof e=="object"&&e!==null&&e.$$typeof===t}function zt(e){var c={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(d){return c[d]})}var yt=/\/+/g;function J(e,c){return typeof e=="object"&&e!==null&&e.key!=null?zt(""+e.key):c.toString(36)}function Jt(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch(typeof e.status=="string"?e.then(B,B):(e.status="pending",e.then(function(c){e.status==="pending"&&(e.status="fulfilled",e.value=c)},function(c){e.status==="pending"&&(e.status="rejected",e.reason=c)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}function U(e,c,d,p,y){var S=typeof e;(S==="undefined"||S==="boolean")&&(e=null);var C=!1;if(e===null)C=!0;else switch(S){case"bigint":case"string":case"number":C=!0;break;case"object":switch(e.$$typeof){case t:case r:C=!0;break;case g:return C=e._init,U(C(e._payload),c,d,p,y)}}if(C)return y=y(e),C=p===""?"."+J(e,0):p,H(y)?(d="",C!=null&&(d=C.replace(yt,"$&/")+"/"),U(y,c,d,"",function(Qt){return Qt})):y!=null&&(z(y)&&(y=Wt(y,d+(y.key==null||e&&e.key===y.key?"":(""+y.key).replace(yt,"$&/")+"/")+C)),c.push(y)),1;C=0;var N=p===""?".":p+":";if(H(e))for(var T=0;T<e.length;T++)p=e[T],S=N+J(p,T),C+=U(p,c,d,S,y);else if(T=A(e),typeof T=="function")for(e=T.call(e),T=0;!(p=e.next()).done;)p=p.value,S=N+J(p,T++),C+=U(p,c,d,S,y);else if(S==="object"){if(typeof e.then=="function")return U(Jt(e),c,d,p,y);throw c=String(e),Error("Objects are not valid as a React child (found: "+(c==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":c)+"). If you meant to render a collection of children, use an array instead.")}return C}function j(e,c,d){if(e==null)return e;var p=[],y=0;return U(e,p,"","",function(S){return c.call(d,S,y++)}),p}function Gt(e){if(e._status===-1){var c=e._result;c=c(),c.then(function(d){(e._status===0||e._status===-1)&&(e._status=1,e._result=d)},function(d){(e._status===0||e._status===-1)&&(e._status=2,e._result=d)}),e._status===-1&&(e._status=0,e._result=c)}if(e._status===1)return e._result.default;throw e._result}var St=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},Kt={map:j,forEach:function(e,c,d){j(e,function(){c.apply(this,arguments)},d)},count:function(e){var c=0;return j(e,function(){c++}),c},toArray:function(e){return j(e,function(c){return c})||[]},only:function(e){if(!z(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};return f.Activity=b,f.Children=Kt,f.Component=P,f.Fragment=o,f.Profiler=s,f.PureComponent=w,f.StrictMode=n,f.Suspense=u,f.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=E,f.__COMPILER_RUNTIME={__proto__:null,c:function(e){return E.H.useMemoCache(e)}},f.cache=function(e){return function(){return e.apply(null,arguments)}},f.cacheSignal=function(){return null},f.cloneElement=function(e,c,d){if(e==null)throw Error("The argument must be a React element, but you passed "+e+".");var p=m({},e.props),y=e.key;if(c!=null)for(S in c.key!==void 0&&(y=""+c.key),c)!ht.call(c,S)||S==="key"||S==="__self"||S==="__source"||S==="ref"&&c.ref===void 0||(p[S]=c[S]);var S=arguments.length-2;if(S===1)p.children=d;else if(1<S){for(var C=Array(S),N=0;N<S;N++)C[N]=arguments[N+2];p.children=C}return W(e.type,y,p)},f.createContext=function(e){return e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:a,_context:e},e},f.createElement=function(e,c,d){var p,y={},S=null;if(c!=null)for(p in c.key!==void 0&&(S=""+c.key),c)ht.call(c,p)&&p!=="key"&&p!=="__self"&&p!=="__source"&&(y[p]=c[p]);var C=arguments.length-2;if(C===1)y.children=d;else if(1<C){for(var N=Array(C),T=0;T<C;T++)N[T]=arguments[T+2];y.children=N}if(e&&e.defaultProps)for(p in C=e.defaultProps,C)y[p]===void 0&&(y[p]=C[p]);return W(e,S,y)},f.createRef=function(){return{current:null}},f.forwardRef=function(e){return{$$typeof:i,render:e}},f.isValidElement=z,f.lazy=function(e){return{$$typeof:g,_payload:{_status:-1,_result:e},_init:Gt}},f.memo=function(e,c){return{$$typeof:_,type:e,compare:c===void 0?null:c}},f.startTransition=function(e){var c=E.T,d={};E.T=d;try{var p=e(),y=E.S;y!==null&&y(d,p),typeof p=="object"&&p!==null&&typeof p.then=="function"&&p.then(B,St)}catch(S){St(S)}finally{c!==null&&d.types!==null&&(c.types=d.types),E.T=c}},f.unstable_useCacheRefresh=function(){return E.H.useCacheRefresh()},f.use=function(e){return E.H.use(e)},f.useActionState=function(e,c,d){return E.H.useActionState(e,c,d)},f.useCallback=function(e,c){return E.H.useCallback(e,c)},f.useContext=function(e){return E.H.useContext(e)},f.useDebugValue=function(){},f.useDeferredValue=function(e,c){return E.H.useDeferredValue(e,c)},f.useEffect=function(e,c){return E.H.useEffect(e,c)},f.useEffectEvent=function(e){return E.H.useEffectEvent(e)},f.useId=function(){return E.H.useId()},f.useImperativeHandle=function(e,c,d){return E.H.useImperativeHandle(e,c,d)},f.useInsertionEffect=function(e,c){return E.H.useInsertionEffect(e,c)},f.useLayoutEffect=function(e,c){return E.H.useLayoutEffect(e,c)},f.useMemo=function(e,c){return E.H.useMemo(e,c)},f.useOptimistic=function(e,c){return E.H.useOptimistic(e,c)},f.useReducer=function(e,c,d){return E.H.useReducer(e,c,d)},f.useRef=function(e){return E.H.useRef(e)},f.useState=function(e){return E.H.useState(e)},f.useSyncExternalStore=function(e,c,d){return E.H.useSyncExternalStore(e,c,d)},f.useTransition=function(){return E.H.useTransition()},f.version="19.2.0",f}var X;function Rt(){return X||(X=1,x.exports=gt()),x.exports}var bt=Rt(),D=Ct(bt);const It=t=>t;function At(t,r=It){const o=D.useSyncExternalStore(t.subscribe,D.useCallback(()=>r(t.getState()),[t,r]),D.useCallback(()=>r(t.getInitialState()),[t,r]));return D.useDebugValue(o),o}const Tt=t=>{const r=Q(t),o=n=>At(r,n);return Object.assign(o,r),o},wt=(t=>Tt);function Z(t,r){let o;try{o=t()}catch{return}return{getItem:s=>{var a;const l=u=>u===null?null:JSON.parse(u,void 0),i=(a=o.getItem(s))!=null?a:null;return i instanceof Promise?i.then(l):l(i)},setItem:(s,a)=>o.setItem(s,JSON.stringify(a,void 0)),removeItem:s=>o.removeItem(s)}}const F=t=>r=>{try{const o=t(r);return o instanceof Promise?o:{then(n){return F(n)(o)},catch(n){return this}}}catch(o){return{then(n){return this},catch(n){return F(n)(o)}}}},Pt=(t,r)=>(o,n,s)=>{let a={storage:Z(()=>localStorage),partialize:m=>m,version:0,merge:(m,L)=>({...L,...m}),...r},l=!1;const i=new Set,u=new Set;let _=a.storage;if(!_)return t((...m)=>{console.warn(`[zustand persist middleware] Unable to update item '${a.name}', the given storage is currently unavailable.`),o(...m)},n,s);const g=()=>{const m=a.partialize({...n()});return _.setItem(a.name,{state:m,version:a.version})},b=s.setState;s.setState=(m,L)=>(b(m,L),g());const I=t((...m)=>(o(...m),g()),n,s);s.getInitialState=()=>I;let A;const M=()=>{var m,L;if(!_)return;l=!1,i.forEach(R=>{var w;return R((w=n())!=null?w:I)});const P=((L=a.onRehydrateStorage)==null?void 0:L.call(a,(m=n())!=null?m:I))||void 0;return F(_.getItem.bind(_))(a.name).then(R=>{if(R)if(typeof R.version=="number"&&R.version!==a.version){if(a.migrate){const w=a.migrate(R.state,R.version);return w instanceof Promise?w.then(O=>[!0,O]):[!0,w]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,R.state];return[!1,void 0]}).then(R=>{var w;const[O,H]=R;if(A=a.merge(H,(w=n())!=null?w:I),o(A,!0),O)return g()}).then(()=>{P?.(A,void 0),A=n(),l=!0,u.forEach(R=>R(A))}).catch(R=>{P?.(void 0,R)})};return s.persist={setOptions:m=>{a={...a,...m},m.storage&&(_=m.storage)},clearStorage:()=>{_?.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>M(),hasHydrated:()=>l,onHydrate:m=>(i.add(m),()=>{i.delete(m)}),onFinishHydration:m=>(u.add(m),()=>{u.delete(m)})},a.skipHydration||M(),A||I};var tt=(t,r,o)=>(s,a)=>({pastStates:o?.pastStates||[],futureStates:o?.futureStates||[],undo:(l=1)=>{if(a().pastStates.length){const i=o?.partialize?.(r())||r(),u=a().pastStates.splice(-l,l),_=u.shift();t(_),s({pastStates:a().pastStates,futureStates:a().futureStates.concat(o?.diff?.(i,_)||i,u.reverse())})}},redo:(l=1)=>{if(a().futureStates.length){const i=o?.partialize?.(r())||r(),u=a().futureStates.splice(-l,l),_=u.shift();t(_),s({pastStates:a().pastStates.concat(o?.diff?.(i,_)||i,u.reverse()),futureStates:a().futureStates})}},clear:()=>s({pastStates:[],futureStates:[]}),isTracking:!0,pause:()=>s({isTracking:!1}),resume:()=>s({isTracking:!0}),setOnSave:l=>s({_onSave:l}),_onSave:o?.onSave,_handleSet:(l,i,u,_)=>{o?.limit&&a().pastStates.length>=o?.limit&&a().pastStates.shift(),a()._onSave?.(l,u),s({pastStates:a().pastStates.concat(_||l),futureStates:[]})}}),Nt=(t,r)=>(n,s,a)=>{a.temporal=Q(r?.wrapTemporal?.(tt(n,s,r))||tt(n,s,r));const l=r?.handleSet?.(a.temporal.getState()._handleSet)||a.temporal.getState()._handleSet,i=_=>{if(!a.temporal.getState().isTracking)return;const g=r?.partialize?.(s())||s(),b=r?.diff?.(_,g);b===null||r?.equality?.(_,g)||l(_,void 0,g,b)},u=a.setState;return a.setState=(..._)=>{const g=r?.partialize?.(s())||s();u(..._),i(g)},t((..._)=>{const g=r?.partialize?.(s())||s();n(..._),i(g)},s,a)};const Lt=t=>({customer:{name:"",phone:"",address:"",taxId:"",installationAddress:"",useSameAddress:!0,showInstallationAddress:!0},setCustomer:r=>t(o=>({customer:{...o.customer,...r}}))}),Mt=t=>t.type===v.CURTAIN,Ot=t=>t.type===v.WALLPAPER,kt=t=>t.type===v.REMOVAL,Ut=t=>!Mt(t)&&!Ot(t)&&!kt(t),$=()=>Math.random().toString(36).substring(2,9),$t=t=>({rooms:[],addRoom:r=>t(o=>({rooms:[...o.rooms,{id:$(),name:r||`‡∏´‡πâ‡∏≠‡∏á ${o.rooms.length+1}`,items:[],is_suspended:!1,room_defaults:{}}]})),updateRoom:(r,o)=>t(n=>({rooms:n.rooms.map(s=>s.id===r?{...s,...o}:s)})),removeRoom:r=>t(o=>({rooms:o.rooms.filter(n=>n.id!==r)})),duplicateRoom:r=>t(o=>{const n=o.rooms.find(a=>a.id===r);if(!n)return o;const s={...n,id:$(),name:`${n.name} (Copy)`,items:n.items.map(a=>({...a,id:$()}))};return{rooms:[...o.rooms,s]}}),toggleRoomSuspension:r=>t(o=>({rooms:o.rooms.map(n=>n.id===r?{...n,is_suspended:!n.is_suspended}:n)})),updateRoomDefaults:(r,o)=>t(n=>({rooms:n.rooms.map(s=>s.id===r?{...s,room_defaults:{...s.room_defaults,...o}}:s)})),addItem:(r,o)=>t(n=>({rooms:n.rooms.map(s=>s.id!==r?s:{...s,items:[...s.items,{...o,id:$()}]})})),updateItem:(r,o,n)=>t(s=>({rooms:s.rooms.map(a=>a.id!==r?a:{...a,items:a.items.map(l=>l.id===o?{...l,...n}:l)})})),removeItem:(r,o)=>t(n=>({rooms:n.rooms.map(s=>s.id!==r?s:{...s,items:s.items.filter(a=>a.id!==o)})})),duplicateItem:(r,o)=>t(n=>({rooms:n.rooms.map(s=>{if(s.id!==r)return s;const a=s.items.findIndex(_=>_.id===o);if(a===-1)return s;const i={...s.items[a],id:$()},u=[...s.items];return u.splice(a+1,0,i),{...s,items:u}})})),updatePriceByCode:(r,o,n)=>{let s=0;const a=String(n);return t(l=>({rooms:l.rooms.map(i=>({...i,items:i.items.map(u=>r===q.CURTAIN_MAIN&&u.type===v.CURTAIN&&u.code===o?(s++,{...u,price_per_m_raw:a}):r===q.CURTAIN_SHEER&&u.type===v.CURTAIN&&u.sheer_code===o?(s++,{...u,sheer_price_per_m:a}):r===q.WALLPAPER&&u.type===v.WALLPAPER&&u.wallpaper_code===o?(s++,{...u,price_per_roll:n}):r===u.type&&Ut(u)&&u.code===o?(s++,{...u,price_sqyd:n}):u)}))})),s},resetProject:()=>t(()=>({rooms:[],customer:{name:"",phone:"",address:"",taxId:"",installationAddress:"",useSameAddress:!0,showInstallationAddress:!0},discount:{type:"amount",value:0}})),factoryReset:()=>{localStorage.removeItem("marnthara.input.v6.4"),window.location.reload()}}),Dt=t=>({shopConfig:vt,discount:{type:"amount",value:0},setDiscount:r=>t({discount:r}),updateShopConfig:r=>t(o=>({shopConfig:{...o.shopConfig,...r}})),updateLogo:r=>t(o=>({shopConfig:{...o.shopConfig,logoUrl:r}}))}),Ht=()=>Math.random().toString(36).substring(2,9),jt=(t,r)=>({favorites:{},addFavorite:(o,n)=>{n.cost_per_yard&&n.cost_per_yard>0&&r().updateFabricCost(n.code,n.cost_per_yard);const s={...n};delete s.cost_per_yard,t(a=>({favorites:{...a.favorites,[o]:[...a.favorites[o]||[],{...s,id:Ht()}]}}))},removeFavorite:(o,n)=>t(s=>({favorites:{...s.favorites,[o]:(s.favorites[o]||[]).filter(a=>a.id!==n)}})),updateFavorite:(o,n,s)=>{s.cost_per_yard&&s.cost_per_yard>0&&s.code&&(r().updateFabricCost(s.code,s.cost_per_yard),delete s.cost_per_yard),t(a=>({favorites:{...a.favorites,[o]:(a.favorites[o]||[]).map(l=>l.id===n?{...l,...s}:l)}}))},importFavorites:o=>{try{let n;const s=o.trim();try{n=JSON.parse(s)}catch{try{const i=decodeURIComponent(escape(atob(s)));n=JSON.parse(i)}catch{return!1}}const a=n.favorites?n.favorites:n;if(typeof a!="object"||a===null)return!1;const l={...a};return Object.values(l).forEach(i=>{Array.isArray(i)&&i.forEach(u=>{u.cost_per_yard&&u.cost_per_yard>0&&(r().updateFabricCost(u.code,u.cost_per_yard),delete u.cost_per_yard)})}),t(i=>({favorites:{...i.favorites,...l}})),!0}catch(n){return console.error(n),!1}}}),qt=t=>({activeModal:null,modalProps:{},modalStack:[],openModal:(r,o={})=>t(n=>n.activeModal&&n.activeModal!==r?{modalStack:[...n.modalStack,{type:n.activeModal,props:n.modalProps}],activeModal:r,modalProps:o}:{activeModal:r,modalProps:o}),closeModal:()=>t(r=>{if(r.modalStack.length>0){const o=r.modalStack[r.modalStack.length-1],n=r.modalStack.slice(0,-1);return{activeModal:o.type,modalProps:o.props,modalStack:n}}return{activeModal:null,modalProps:{}}}),closeAllModals:()=>t({activeModal:null,modalProps:{},modalStack:[]})}),et={},rt={},xt=(t,r)=>({laborCosts:et,accessoryCosts:rt,fabricCosts:{},updateLaborCost:(o,n)=>t(s=>({laborCosts:{...s.laborCosts,[o]:{...s.laborCosts[o]||{},...n}}})),updateAccessoryCost:(o,n)=>t(s=>({accessoryCosts:{...s.accessoryCosts,[o]:n}})),removeAccessoryCost:o=>t(n=>{const s={...n.accessoryCosts};return delete s[o],{accessoryCosts:s}}),updateFabricCost:(o,n)=>t(s=>({fabricCosts:{...s.fabricCosts,[o]:n}})),removeFabricCost:o=>t(n=>{const s={...n.fabricCosts};return delete s[o],{fabricCosts:s}}),updateUnifiedCost:(o,n)=>{r().updateFabricCost(o,n)},batchUpdateFabricCosts:o=>t(n=>({fabricCosts:{...n.fabricCosts,...o}})),resetProductionCosts:()=>t(()=>({laborCosts:et,accessoryCosts:rt,fabricCosts:{}})),exportSecrets:()=>{const{laborCosts:o,accessoryCosts:n,fabricCosts:s}=r();return JSON.stringify({laborCosts:o,accessoryCosts:n,fabricCosts:s},null,2)},importSecrets:o=>{try{const n=JSON.parse(o);return!n.laborCosts&&!n.accessoryCosts&&!n.fabricCosts?!1:(t(s=>({laborCosts:{...s.laborCosts,...n.laborCosts},accessoryCosts:{...s.accessoryCosts,...n.accessoryCosts},fabricCosts:{...s.fabricCosts,...n.fabricCosts}})),!0)}catch(n){return console.error("Import failed",n),!1}}}),ot={curtain:{multiplier_wave:2.7,multiplier_pleated:2.7,multiplier_eyelet:2.7,multiplier_roman:1.5,roman_blind_offset:.45,hem_offset:.1,yard_conversion:1.11},wallpaper:{roll_width:.53,roll_length:10,waste_margin:.1},area:{sqm_to_sqyd:1.2,min_yield:1}},Ft=t=>({formulas:ot,updateFormula:(r,o)=>t(n=>({formulas:{...n.formulas,[r]:{...n.formulas[r],...o}}})),resetFormulas:()=>t(()=>({formulas:ot}))}),Yt=t=>{const r={...t};return delete r.activeModal,delete r.modalProps,delete r.modalStack,r},Y=wt()(Nt(Pt((...t)=>({...Lt(...t),...$t(...t),...Dt(...t),...jt(...t),...qt(...t),...xt(...t),...Ft(...t)}),{name:mt,storage:Z(()=>localStorage),version:1,partialize:t=>Yt(t)}),{limit:20,partialize:t=>{const{rooms:r,customer:o,shopConfig:n,discount:s,laborCosts:a,accessoryCosts:l,fabricCosts:i,favorites:u,formulas:_}=t;return{rooms:r,customer:o,shopConfig:n,discount:s,laborCosts:a,accessoryCosts:l,fabricCosts:i,favorites:u,formulas:_}}})),nt=(t,r)=>{if(r<=0)return 0;const{formulas:o}=Y.getState(),n=o.curtain;let s=0;if(t==="‡∏û‡∏±‡∏ö")s=r+n.roman_blind_offset;else{let a=n.multiplier_wave;t==="‡∏à‡∏µ‡∏ö"&&(a=n.multiplier_pleated),t==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"&&(a=n.multiplier_eyelet),s=r*a}return s*n.yard_conversion},Bt=t=>Et.style_surcharge[t]||0,st={calculate:t=>{const r=h(t.width_m);if(r<=0)return{total:0,breakdown:{}};let o=0;t.price_per_m_raw&&h(t.price_per_m_raw)>0?o=r*h(t.price_per_m_raw):o=nt(t.style,r)*h(t.price_sqyd);let n=0;t.layer_mode!=="main"&&(t.sheer_price_per_m&&h(t.sheer_price_per_m)>0?n=r*h(t.sheer_price_per_m):t.sheer_price_sqyd&&(n=nt(t.style,r)*h(t.sheer_price_sqyd)));let s=0;if(t.use_rail&&t.rail_price_per_m){const i=t.layer_mode==="double"?2:1;s=r*h(t.rail_price_per_m)*i}const a=Bt(t.style);let l=o+n+s+a;return t.enable_set_price&&h(t.set_price_override)>0&&(l=h(t.set_price_override)),l=Math.round(l*100)/100,{total:l,breakdown:{fabricPrice:o,sheerPrice:n,railPrice:s,accessoryPrice:a,fabricMeters:r}}},validate:t=>{const r=[];return h(t.width_m)<=0&&r.push("‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0"),h(t.height_m)<=0&&r.push("‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0"),t.style||r.push("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏°‡πà‡∏≤‡∏ô"),r},getSpecs:t=>{const r=[`‡∏Ç‡∏ô‡∏≤‡∏î: ‡∏Å‡∏ß‡πâ‡∏≤‡∏á ${t.width_m} ‡∏°. x ‡∏™‡∏π‡∏á ${t.height_m} ‡∏°.`,`‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: ${t.style}`];return t.fabric_variant&&r.push(`‡∏£‡∏´‡∏±‡∏™‡∏ú‡πâ‡∏≤: ${t.fabric_variant}`),t.layer_mode==="double"?r.push("‡∏ä‡∏ô‡∏¥‡∏î: ‡∏°‡πà‡∏≤‡∏ô 2 ‡∏ä‡∏±‡πâ‡∏ô (‡∏ó‡∏∂‡∏ö+‡πÇ‡∏õ‡∏£‡πà‡∏á)"):t.layer_mode==="sheer"&&r.push("‡∏ä‡∏ô‡∏¥‡∏î: ‡∏°‡πà‡∏≤‡∏ô‡πÇ‡∏õ‡∏£‡πà‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß"),t.use_rail&&r.push("‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏á‡∏°‡πà‡∏≤‡∏ô"),r}},at={calculate:t=>{const r=t.widths.reduce((A,M)=>A+h(M),0),o=h(t.height_m);if(r<=0||o<=0)return{total:0,breakdown:{}};const{formulas:n}=Y.getState(),s=n.wallpaper,a=o+s.waste_margin,l=Math.floor(s.roll_length/a);let i=0;if(l>0){const A=Math.ceil(r/s.roll_width);i=Math.ceil(A/l)}else i=0;const u=h(t.price_per_roll),_=h(t.install_cost_per_roll),g=i*u,b=i*_;let I=g+b;return t.enable_set_price&&h(t.set_price_override)>0&&(I=h(t.set_price_override)),I=Math.round(I*100)/100,{total:I,breakdown:{rolls:i,materialPrice:g,laborPrice:b,totalWidth:r}}},validate:t=>{const r=[];return t.widths.reduce((n,s)=>n+h(s),0)<=0&&r.push("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏ú‡∏ô‡∏±‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏î‡πâ‡∏≤‡∏ô"),h(t.height_m)<=0&&r.push("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏ú‡∏ô‡∏±‡∏á"),t.wallpaper_code||r.push("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏≠‡∏•‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå"),r},getSpecs:t=>{const r=t.widths.reduce((i,u)=>i+h(u),0),o=[`‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏£‡∏ß‡∏° ${r.toFixed(2)} ‡∏°. x ‡∏™‡∏π‡∏á ${t.height_m} ‡∏°.`];t.wallpaper_code&&o.push(`‡∏£‡∏´‡∏±‡∏™: ${t.wallpaper_code}`);const{formulas:n}=Y.getState(),s=n.wallpaper,a=h(t.height_m);let l=0;if(a>0&&r>0){const i=a+s.waste_margin,u=Math.floor(s.roll_length/i);if(u>0){const _=Math.ceil(r/s.roll_width);l=Math.ceil(_/u)}}return o.push(`‡πÉ‡∏ä‡πâ: ${l} ‡∏°‡πâ‡∏ß‡∏ô (‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)`),o}},ct={calculate:t=>{if(t.enable_set_price&&h(t.set_price_override)>0)return{total:h(t.set_price_override)};const r=h(t.quantity),o=h(t.price_per_item);if(r<=0||o<=0)return{total:0};const n=r*o;return{total:Math.round(n*100)/100}},validate:t=>{const r=[];return t.description||r.push("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô"),!t.enable_set_price&&h(t.price_per_item)<=0&&r.push("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢"),r},getSpecs:t=>{const r=[];t.description&&r.push(t.description);const o=h(t.quantity);return o>0&&r.push(`‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${o} ‡∏à‡∏∏‡∏î/‡∏ä‡∏∏‡∏î`),r}},k=t=>{const{minAreaSqyd:r=1}=t;return{calculate:o=>{if(o.enable_set_price&&h(o.set_price_override)>0)return{total:h(o.set_price_override)};const n=h(o.width_m),s=h(o.height_m),a=h(o.price_sqyd);if(n<=0||s<=0)return{total:0,breakdown:{}};const l=n*s;let i=l*G;i<r&&(i=r);let u=i*a;return u=Math.round(u*100)/100,{total:u,breakdown:{areaSqm:l,areaSqyd:i,pricePerUnit:a}}},validate:o=>{const n=[];return h(o.width_m)<=0&&n.push("‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á"),h(o.height_m)<=0&&n.push("‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á"),!o.enable_set_price&&h(o.price_sqyd)<=0&&n.push("‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠ ‡∏ï‡∏£.‡∏•."),n},getSpecs:o=>{const n=[`‡∏Ç‡∏ô‡∏≤‡∏î: ${o.width_m} x ${o.height_m} ‡∏°.`];o.code&&n.push(`‡∏£‡∏´‡∏±‡∏™/‡∏™‡∏µ: ${o.code}`),o.fabric_variant&&n.push(`‡∏£‡∏∏‡πà‡∏ô: ${o.fabric_variant}`);const s=h(o.width_m),a=h(o.height_m);if(s>0&&a>0){const l=Math.max(s*a*G,r);n.push(`‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì: ${l.toFixed(2)} ‡∏ï‡∏£.‡∏•.`)}return n}}},ut=k({}),it=k({}),lt=k({}),ft=k({}),pt=k({}),dt=k({}),_t={calculatePrice:t=>{const r=_t.calculateDetailedPrice(t).total;return Number.isFinite(r)?r:0},calculateDetailedPrice:t=>{if(!t||!t.type)return{total:0};try{switch(t.type){case v.CURTAIN:return st.calculate(t);case v.WALLPAPER:return at.calculate(t);case v.WOODEN_BLIND:return ut.calculate(t);case v.ROLLER_BLIND:return it.calculate(t);case v.VERTICAL_BLIND:return lt.calculate(t);case v.ALUMINUM_BLIND:return ft.calculate(t);case v.PARTITION:return pt.calculate(t);case v.PLEATED_SCREEN:return dt.calculate(t);case v.REMOVAL:return ct.calculate(t);default:return console.warn("[PricingEngine] ‚ö†Ô∏è Unknown item type detected:",t),{total:0}}}catch(r){return console.error("[PricingEngine] üí• Critical Calculation Error:",r),{total:0}}},getItemSpecs:t=>{if(!t||!t.type)return[];try{switch(t.type){case v.CURTAIN:return st.getSpecs(t);case v.WALLPAPER:return at.getSpecs(t);case v.WOODEN_BLIND:return ut.getSpecs(t);case v.ROLLER_BLIND:return it.getSpecs(t);case v.VERTICAL_BLIND:return lt.getSpecs(t);case v.ALUMINUM_BLIND:return ft.getSpecs(t);case v.PARTITION:return pt.getSpecs(t);case v.PLEATED_SCREEN:return dt.getSpecs(t);case v.REMOVAL:return ct.getSpecs(t);default:return[]}}catch{return["Error generating specs"]}}};self.onmessage=t=>{const{id:r,items:o}=t.data;try{const n=o.map(a=>({itemId:a.id,total:_t.calculatePrice(a)})),s={id:r,results:n};self.postMessage(s)}catch(n){console.error("Worker Calculation Error:",n),self.postMessage({id:r,results:[],error:n instanceof Error?n.message:"Unknown worker error"})}}})();
