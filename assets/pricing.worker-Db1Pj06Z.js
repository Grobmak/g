(function(){"use strict";const E={CURTAIN:"curtain",WALLPAPER:"wallpaper",WOODEN_BLIND:"wooden_blind",ROLLER_BLIND:"roller_blind",VERTICAL_BLIND:"vertical_blind",ALUMINUM_BLIND:"aluminum_blind",PARTITION:"partition",PLEATED_SCREEN:"pleated_screen",REMOVAL:"removal"},q={CURTAIN_MAIN:"curtain_main",CURTAIN_SHEER:"curtain_sheer",WALLPAPER:E.WALLPAPER},U={MAIN:"main",SHEER:"sheer",DOUBLE:"double"},y=t=>{if(typeof t=="number")return Number.isFinite(t)?t:0;if(!t)return 0;const r=typeof t=="string"?t.replace(/,/g,""):String(t),n=parseFloat(r);return Number.isFinite(n)?n:0},V=t=>{let r;const n=new Set,o=(f,h)=>{const R=typeof f=="function"?f(r):f;if(!Object.is(R,r)){const I=r;r=h??(typeof R!="object"||R===null)?R:Object.assign({},r,R),n.forEach(b=>b(r,I))}},s=()=>r,l={setState:o,getState:s,getInitialState:()=>u,subscribe:f=>(n.add(f),()=>n.delete(f))},u=r=t(o,s,l);return l},G=(t=>t?V(t):V);function St(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var W={exports:{}},p={};var Q;function vt(){if(Q)return p;Q=1;var t=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),i=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),R=Symbol.for("react.activity"),I=Symbol.iterator;function b(e){return e===null||typeof e!="object"?null:(e=I&&e[I]||e["@@iterator"],typeof e=="function"?e:null)}var P={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,M={};function N(e,c,_){this.props=e,this.context=c,this.refs=M,this.updater=_||P}N.prototype.isReactComponent={},N.prototype.setState=function(e,c){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,c,"setState")},N.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function A(){}A.prototype=N.prototype;function w(e,c,_){this.props=e,this.context=c,this.refs=M,this.updater=_||P}var O=w.prototype=new A;O.constructor=w,S(O,N.prototype),O.isPureReactComponent=!0;var Y=Array.isArray;function x(){}var g={H:null,A:null,T:null,S:null},yt=Object.prototype.hasOwnProperty;function z(e,c,_){var d=_.ref;return{$$typeof:t,type:e,key:c,ref:d!==void 0?d:null,props:_}}function qt(e,c){return z(e.type,c,e.props)}function J(e){return typeof e=="object"&&e!==null&&e.$$typeof===t}function Wt(e){var c={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(_){return c[_]})}var mt=/\/+/g;function K(e,c){return typeof e=="object"&&e!==null&&e.key!=null?Wt(""+e.key):c.toString(36)}function Ft(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch(typeof e.status=="string"?e.then(x,x):(e.status="pending",e.then(function(c){e.status==="pending"&&(e.status="fulfilled",e.value=c)},function(c){e.status==="pending"&&(e.status="rejected",e.reason=c)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}function k(e,c,_,d,m){var v=typeof e;(v==="undefined"||v==="boolean")&&(e=null);var C=!1;if(e===null)C=!0;else switch(v){case"bigint":case"string":case"number":C=!0;break;case"object":switch(e.$$typeof){case t:case r:C=!0;break;case h:return C=e._init,k(C(e._payload),c,_,d,m)}}if(C)return m=m(e),C=d===""?"."+K(e,0):d,Y(m)?(_="",C!=null&&(_=C.replace(mt,"$&/")+"/"),k(m,c,_,"",function(Jt){return Jt})):m!=null&&(J(m)&&(m=qt(m,_+(m.key==null||e&&e.key===m.key?"":(""+m.key).replace(mt,"$&/")+"/")+C)),c.push(m)),1;C=0;var L=d===""?".":d+":";if(Y(e))for(var T=0;T<e.length;T++)d=e[T],v=L+K(d,T),C+=k(d,c,_,v,m);else if(T=b(e),typeof T=="function")for(e=T.call(e),T=0;!(d=e.next()).done;)d=d.value,v=L+K(d,T++),C+=k(d,c,_,v,m);else if(v==="object"){if(typeof e.then=="function")return k(Ft(e),c,_,d,m);throw c=String(e),Error("Objects are not valid as a React child (found: "+(c==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":c)+"). If you meant to render a collection of children, use an array instead.")}return C}function B(e,c,_){if(e==null)return e;var d=[],m=0;return k(e,d,"","",function(v){return c.call(_,v,m++)}),d}function xt(e){if(e._status===-1){var c=e._result;c=c(),c.then(function(_){(e._status===0||e._status===-1)&&(e._status=1,e._result=_)},function(_){(e._status===0||e._status===-1)&&(e._status=2,e._result=_)}),e._status===-1&&(e._status=0,e._result=c)}if(e._status===1)return e._result.default;throw e._result}var ht=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},zt={map:B,forEach:function(e,c,_){B(e,function(){c.apply(this,arguments)},_)},count:function(e){var c=0;return B(e,function(){c++}),c},toArray:function(e){return B(e,function(c){return c})||[]},only:function(e){if(!J(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};return p.Activity=R,p.Children=zt,p.Component=N,p.Fragment=n,p.Profiler=s,p.PureComponent=w,p.StrictMode=o,p.Suspense=u,p.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=g,p.__COMPILER_RUNTIME={__proto__:null,c:function(e){return g.H.useMemoCache(e)}},p.cache=function(e){return function(){return e.apply(null,arguments)}},p.cacheSignal=function(){return null},p.cloneElement=function(e,c,_){if(e==null)throw Error("The argument must be a React element, but you passed "+e+".");var d=S({},e.props),m=e.key;if(c!=null)for(v in c.key!==void 0&&(m=""+c.key),c)!yt.call(c,v)||v==="key"||v==="__self"||v==="__source"||v==="ref"&&c.ref===void 0||(d[v]=c[v]);var v=arguments.length-2;if(v===1)d.children=_;else if(1<v){for(var C=Array(v),L=0;L<v;L++)C[L]=arguments[L+2];d.children=C}return z(e.type,m,d)},p.createContext=function(e){return e={$$typeof:i,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:a,_context:e},e},p.createElement=function(e,c,_){var d,m={},v=null;if(c!=null)for(d in c.key!==void 0&&(v=""+c.key),c)yt.call(c,d)&&d!=="key"&&d!=="__self"&&d!=="__source"&&(m[d]=c[d]);var C=arguments.length-2;if(C===1)m.children=_;else if(1<C){for(var L=Array(C),T=0;T<C;T++)L[T]=arguments[T+2];m.children=L}if(e&&e.defaultProps)for(d in C=e.defaultProps,C)m[d]===void 0&&(m[d]=C[d]);return z(e,v,m)},p.createRef=function(){return{current:null}},p.forwardRef=function(e){return{$$typeof:l,render:e}},p.isValidElement=J,p.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:xt}},p.memo=function(e,c){return{$$typeof:f,type:e,compare:c===void 0?null:c}},p.startTransition=function(e){var c=g.T,_={};g.T=_;try{var d=e(),m=g.S;m!==null&&m(_,d),typeof d=="object"&&d!==null&&typeof d.then=="function"&&d.then(x,ht)}catch(v){ht(v)}finally{c!==null&&_.types!==null&&(c.types=_.types),g.T=c}},p.unstable_useCacheRefresh=function(){return g.H.useCacheRefresh()},p.use=function(e){return g.H.use(e)},p.useActionState=function(e,c,_){return g.H.useActionState(e,c,_)},p.useCallback=function(e,c){return g.H.useCallback(e,c)},p.useContext=function(e){return g.H.useContext(e)},p.useDebugValue=function(){},p.useDeferredValue=function(e,c){return g.H.useDeferredValue(e,c)},p.useEffect=function(e,c){return g.H.useEffect(e,c)},p.useEffectEvent=function(e){return g.H.useEffectEvent(e)},p.useId=function(){return g.H.useId()},p.useImperativeHandle=function(e,c,_){return g.H.useImperativeHandle(e,c,_)},p.useInsertionEffect=function(e,c){return g.H.useInsertionEffect(e,c)},p.useLayoutEffect=function(e,c){return g.H.useLayoutEffect(e,c)},p.useMemo=function(e,c){return g.H.useMemo(e,c)},p.useOptimistic=function(e,c){return g.H.useOptimistic(e,c)},p.useReducer=function(e,c,_){return g.H.useReducer(e,c,_)},p.useRef=function(e){return g.H.useRef(e)},p.useState=function(e){return g.H.useState(e)},p.useSyncExternalStore=function(e,c,_){return g.H.useSyncExternalStore(e,c,_)},p.useTransition=function(){return g.H.useTransition()},p.version="19.2.1",p}var X;function Et(){return X||(X=1,W.exports=vt()),W.exports}var gt=Et(),$=St(gt);const Ct=t=>t;function Rt(t,r=Ct){const n=$.useSyncExternalStore(t.subscribe,$.useCallback(()=>r(t.getState()),[t,r]),$.useCallback(()=>r(t.getInitialState()),[t,r]));return $.useDebugValue(n),n}const It=t=>{const r=G(t),n=o=>Rt(r,o);return Object.assign(n,r),n},bt=(t=>It);function Z(t,r){let n;try{n=t()}catch{return}return{getItem:s=>{var a;const i=u=>u===null?null:JSON.parse(u,void 0),l=(a=n.getItem(s))!=null?a:null;return l instanceof Promise?l.then(i):i(l)},setItem:(s,a)=>n.setItem(s,JSON.stringify(a,void 0)),removeItem:s=>n.removeItem(s)}}const F=t=>r=>{try{const n=t(r);return n instanceof Promise?n:{then(o){return F(o)(n)},catch(o){return this}}}catch(n){return{then(o){return this},catch(o){return F(o)(n)}}}},At=(t,r)=>(n,o,s)=>{let a={storage:Z(()=>localStorage),partialize:S=>S,version:0,merge:(S,M)=>({...M,...S}),...r},i=!1;const l=new Set,u=new Set;let f=a.storage;if(!f)return t((...S)=>{console.warn(`[zustand persist middleware] Unable to update item '${a.name}', the given storage is currently unavailable.`),n(...S)},o,s);const h=()=>{const S=a.partialize({...o()});return f.setItem(a.name,{state:S,version:a.version})},R=s.setState;s.setState=(S,M)=>(R(S,M),h());const I=t((...S)=>(n(...S),h()),o,s);s.getInitialState=()=>I;let b;const P=()=>{var S,M;if(!f)return;i=!1,l.forEach(A=>{var w;return A((w=o())!=null?w:I)});const N=((M=a.onRehydrateStorage)==null?void 0:M.call(a,(S=o())!=null?S:I))||void 0;return F(f.getItem.bind(f))(a.name).then(A=>{if(A)if(typeof A.version=="number"&&A.version!==a.version){if(a.migrate){const w=a.migrate(A.state,A.version);return w instanceof Promise?w.then(O=>[!0,O]):[!0,w]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,A.state];return[!1,void 0]}).then(A=>{var w;const[O,Y]=A;if(b=a.merge(Y,(w=o())!=null?w:I),n(b,!0),O)return h()}).then(()=>{N?.(b,void 0),b=o(),i=!0,u.forEach(A=>A(b))}).catch(A=>{N?.(void 0,A)})};return s.persist={setOptions:S=>{a={...a,...S},S.storage&&(f=S.storage)},clearStorage:()=>{f?.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>P(),hasHydrated:()=>i,onHydrate:S=>(l.add(S),()=>{l.delete(S)}),onFinishHydration:S=>(u.add(S),()=>{u.delete(S)})},a.skipHydration||P(),b||I};var tt=(t,r,n)=>(s,a)=>({pastStates:n?.pastStates||[],futureStates:n?.futureStates||[],undo:(i=1)=>{if(a().pastStates.length){const l=n?.partialize?.(r())||r(),u=a().pastStates.splice(-i,i),f=u.shift();t(f),s({pastStates:a().pastStates,futureStates:a().futureStates.concat(n?.diff?.(l,f)||l,u.reverse())})}},redo:(i=1)=>{if(a().futureStates.length){const l=n?.partialize?.(r())||r(),u=a().futureStates.splice(-i,i),f=u.shift();t(f),s({pastStates:a().pastStates.concat(n?.diff?.(l,f)||l,u.reverse()),futureStates:a().futureStates})}},clear:()=>s({pastStates:[],futureStates:[]}),isTracking:!0,pause:()=>s({isTracking:!1}),resume:()=>s({isTracking:!0}),setOnSave:i=>s({_onSave:i}),_onSave:n?.onSave,_handleSet:(i,l,u,f)=>{n?.limit&&a().pastStates.length>=n?.limit&&a().pastStates.shift(),a()._onSave?.(i,u),s({pastStates:a().pastStates.concat(f||i),futureStates:[]})}}),Tt=(t,r)=>(o,s,a)=>{a.temporal=G(r?.wrapTemporal?.(tt(o,s,r))||tt(o,s,r));const i=r?.handleSet?.(a.temporal.getState()._handleSet)||a.temporal.getState()._handleSet,l=f=>{if(!a.temporal.getState().isTracking)return;const h=r?.partialize?.(s())||s(),R=r?.diff?.(f,h);R===null||r?.equality?.(f,h)||i(f,void 0,h,R)},u=a.setState;return a.setState=(...f)=>{const h=r?.partialize?.(s())||s();u(...f),l(h)},t((...f)=>{const h=r?.partialize?.(s())||s();o(...f),l(h)},s,a)};const Pt="marnthara.input.v6.4",wt={name:"Marnthara Smart Quotation",address:"123/45 ‡∏ñ‡∏ô‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏ï‡∏≥‡∏ö‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø 10110",phone:"081-234-5678",taxId:"",logoUrl:"",baseVatRate:0,bankAccount:{bankName:"‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢",accountName:"‡∏ö‡∏à‡∏Å. ‡∏°‡πà‡∏≤‡∏ô‡∏ò‡∏≤‡∏£‡∏≤ ‡πÄ‡∏î‡∏Ñ‡∏Ñ‡∏≠‡∏£‡πå",accountNumber:"123-4-56789-0",branch:"‡πÄ‡∏ã‡πá‡∏ô‡∏ó‡∏£‡∏±‡∏•‡πÄ‡∏ß‡∏¥‡∏•‡∏î‡πå",isEnabled:!0},pdf:{paymentTerms:"‡∏°‡∏±‡∏î‡∏à‡∏≥ 50% ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô",priceValidity:"‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏ô‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ú‡∏• 30 ‡∏ß‡∏±‡∏ô",notes:["‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß (‡πÉ‡∏ô‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£)","‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á 1 ‡∏õ‡∏µ (‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ú‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó)"]}},Nt=t=>({customer:{name:"",phone:"",address:"",taxId:"",installationAddress:"",useSameAddress:!0,showInstallationAddress:!0},setCustomer:r=>t(n=>({customer:{...n.customer,...r}}))}),Lt=t=>t.type===E.CURTAIN,Mt=t=>t.type===E.WALLPAPER,Ot=t=>t.type===E.REMOVAL,Ut=t=>!Lt(t)&&!Mt(t)&&!Ot(t),H=()=>Math.random().toString(36).substring(2,9),Dt=t=>({rooms:[],addRoom:r=>t(n=>({rooms:[...n.rooms,{id:H(),name:r||`‡∏´‡πâ‡∏≠‡∏á ${n.rooms.length+1}`,items:[],is_suspended:!1,room_defaults:{}}]})),updateRoom:(r,n)=>t(o=>({rooms:o.rooms.map(s=>s.id===r?{...s,...n}:s)})),removeRoom:r=>t(n=>({rooms:n.rooms.filter(o=>o.id!==r)})),duplicateRoom:r=>t(n=>{const o=n.rooms.find(a=>a.id===r);if(!o)return n;const s={...o,id:H(),name:`${o.name} (Copy)`,items:o.items.map(a=>({...a,id:H()}))};return{rooms:[...n.rooms,s]}}),toggleRoomSuspension:r=>t(n=>({rooms:n.rooms.map(o=>o.id===r?{...o,is_suspended:!o.is_suspended}:o)})),updateRoomDefaults:(r,n)=>t(o=>({rooms:o.rooms.map(s=>s.id===r?{...s,room_defaults:{...s.room_defaults,...n}}:s)})),addItem:(r,n)=>t(o=>({rooms:o.rooms.map(s=>s.id!==r?s:{...s,items:[...s.items,{...n,id:H()}]})})),updateItem:(r,n,o)=>t(s=>({rooms:s.rooms.map(a=>a.id!==r?a:{...a,items:a.items.map(i=>i.id===n?{...i,...o}:i)})})),removeItem:(r,n)=>t(o=>({rooms:o.rooms.map(s=>s.id!==r?s:{...s,items:s.items.filter(a=>a.id!==n)})})),duplicateItem:(r,n)=>t(o=>({rooms:o.rooms.map(s=>{if(s.id!==r)return s;const a=s.items.findIndex(f=>f.id===n);if(a===-1)return s;const l={...s.items[a],id:H()},u=[...s.items];return u.splice(a+1,0,l),{...s,items:u}})})),updatePriceByCode:(r,n,o)=>{let s=0;const a=String(o);return t(i=>({rooms:i.rooms.map(l=>({...l,items:l.items.map(u=>r===q.CURTAIN_MAIN&&u.type===E.CURTAIN&&u.code===n?(s++,{...u,price_per_m_raw:a}):r===q.CURTAIN_SHEER&&u.type===E.CURTAIN&&u.sheer_code===n?(s++,{...u,sheer_price_per_m:a}):r===q.WALLPAPER&&u.type===E.WALLPAPER&&u.wallpaper_code===n?(s++,{...u,price_per_roll:o}):r===u.type&&Ut(u)&&u.code===n?(s++,{...u,price_sqyd:o}):u)}))})),s},resetProject:()=>t(()=>({rooms:[],customer:{name:"",phone:"",address:"",taxId:"",installationAddress:"",useSameAddress:!0,showInstallationAddress:!0},discount:{type:"amount",value:0}})),factoryReset:()=>{localStorage.removeItem("marnthara.input.v6.4"),window.location.reload()}}),kt=t=>({shopConfig:wt,discount:{type:"amount",value:0},setDiscount:r=>t({discount:r}),updateShopConfig:r=>t(n=>({shopConfig:{...n.shopConfig,...r}})),updateLogo:r=>t(n=>({shopConfig:{...n.shopConfig,logoUrl:r}}))}),Ht=()=>Math.random().toString(36).substring(2,9),$t=(t,r)=>({inventory:{},addToInventory:(n,o)=>{o.cost_per_yard&&o.cost_per_yard>0&&r().updateFabricCost(o.code,o.cost_per_yard);const s={id:Ht(),code:o.code,default_price_per_m:o.default_price_per_m,note:o.note};t(a=>({inventory:{...a.inventory,[n]:[...a.inventory[n]||[],s]}}))},removeFromInventory:(n,o)=>t(s=>({inventory:{...s.inventory,[n]:(s.inventory[n]||[]).filter(a=>a.id!==o)}})),updateInventoryItem:(n,o,s)=>{s.cost_per_yard&&s.cost_per_yard>0&&s.code&&r().updateFabricCost(s.code,s.cost_per_yard);const a={...s};delete a.cost_per_yard,t(i=>({inventory:{...i.inventory,[n]:(i.inventory[n]||[]).map(l=>l.id===o?{...l,...a}:l)}}))},importInventory:n=>{try{let o;const s=n.trim();try{o=JSON.parse(s)}catch{try{const l=decodeURIComponent(escape(atob(s)));o=JSON.parse(l)}catch{return!1}}const a=o.inventory||o.inventory?o.inventory:null;if(typeof a!="object"||a===null)return!1;const i={...a};return Object.values(i).forEach(l=>{Array.isArray(l)&&l.forEach(u=>{u.cost_per_yard&&u.cost_per_yard>0&&(r().updateFabricCost(u.code,u.cost_per_yard),delete u.cost_per_yard)})}),t(l=>({inventory:{...l.inventory,...i}})),!0}catch(o){return console.error("Import failed:",o),!1}}}),jt=t=>({activeModal:null,modalProps:{},modalStack:[],openModal:(r,n={})=>t(o=>o.activeModal&&o.activeModal!==r?{modalStack:[...o.modalStack,{type:o.activeModal,props:o.modalProps}],activeModal:r,modalProps:n}:{activeModal:r,modalProps:n}),closeModal:()=>t(r=>{if(r.modalStack.length>0){const n=r.modalStack[r.modalStack.length-1],o=r.modalStack.slice(0,-1);return{activeModal:n.type,modalProps:n.props,modalStack:o}}return{activeModal:null,modalProps:{}}}),closeAllModals:()=>t({activeModal:null,modalProps:{},modalStack:[]})}),et={},rt={},Yt=(t,r)=>({laborCosts:et,accessoryCosts:rt,fabricCosts:{},updateLaborCost:(n,o)=>t(s=>({laborCosts:{...s.laborCosts,[n]:{...s.laborCosts[n]||{},...o}}})),updateAccessoryCost:(n,o)=>t(s=>({accessoryCosts:{...s.accessoryCosts,[n]:o}})),removeAccessoryCost:n=>t(o=>{const s={...o.accessoryCosts};return delete s[n],{accessoryCosts:s}}),updateFabricCost:(n,o)=>t(s=>({fabricCosts:{...s.fabricCosts,[n]:o}})),removeFabricCost:n=>t(o=>{const s={...o.fabricCosts};return delete s[n],{fabricCosts:s}}),updateUnifiedCost:(n,o)=>{r().updateFabricCost(n,o)},batchUpdateFabricCosts:n=>t(o=>({fabricCosts:{...o.fabricCosts,...n}})),resetProductionCosts:()=>t(()=>({laborCosts:et,accessoryCosts:rt,fabricCosts:{}})),exportSecrets:()=>{const{laborCosts:n,accessoryCosts:o,fabricCosts:s}=r();return JSON.stringify({laborCosts:n,accessoryCosts:o,fabricCosts:s},null,2)},importSecrets:n=>{try{const o=JSON.parse(n);return!o.laborCosts&&!o.accessoryCosts&&!o.fabricCosts?!1:(t(s=>({laborCosts:{...s.laborCosts,...o.laborCosts},accessoryCosts:{...s.accessoryCosts,...o.accessoryCosts},fabricCosts:{...s.fabricCosts,...o.fabricCosts}})),!0)}catch(o){return console.error("Import failed",o),!1}}}),nt={curtain:{multiplier_wave:2.7,multiplier_pleated:2.7,multiplier_eyelet:2.7,multiplier_roman:1.5,roman_blind_offset:.45,hem_offset:.3,yard_conversion:1.11},wallpaper:{roll_width:.53,roll_length:10,waste_margin:.1},area:{sqm_to_sqyd:1.2,min_yield:1}},Bt=t=>({formulas:nt,updateFormula:(r,n)=>t(o=>({formulas:{...o.formulas,[r]:{...o.formulas[r],...n}}})),resetFormulas:()=>t(()=>({formulas:nt}))}),j=bt()(Tt(At((...t)=>({...Nt(...t),...Dt(...t),...kt(...t),...$t(...t),...jt(...t),...Yt(...t),...Bt(...t)}),{name:Pt,storage:Z(()=>localStorage),version:1,partialize:t=>{const{rooms:r,customer:n,shopConfig:o,discount:s,laborCosts:a,accessoryCosts:i,fabricCosts:l,inventory:u,formulas:f}=t;return{rooms:r,customer:n,shopConfig:o,discount:s,laborCosts:a,accessoryCosts:i,fabricCosts:l,inventory:u,formulas:f}}}),{limit:20,partialize:t=>{const{rooms:r,customer:n,shopConfig:o,discount:s,laborCosts:a,accessoryCosts:i,fabricCosts:l,inventory:u,formulas:f}=t;return{rooms:r,customer:n,shopConfig:o,discount:s,laborCosts:a,accessoryCosts:i,fabricCosts:l,inventory:u,formulas:f}}})),ot=(t,r,n,o)=>{if(t<=0)return 0;const a=(o||j.getState().formulas).curtain;let i=2.5;if(r==="‡∏•‡∏≠‡∏ô")i=a.multiplier_wave??2.7;else if(r==="‡∏à‡∏µ‡∏ö")i=a.multiplier_pleated??2.7;else if(r==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà")i=a.multiplier_eyelet??2.7;else if(r==="‡∏û‡∏±‡∏ö"){const f=a.roman_blind_offset??.45,h=t*i+f;return Math.ceil(h/.9*100)/100}const u=(t*i+(a.hem_offset??.3))/.9;return Math.ceil(u*100)/100},st={calculate:(t,r)=>{if(t.enable_set_price&&y(t.set_price_override)>0)return{total:y(t.set_price_override)};const n=y(t.width_m),o=y(t.height_m);if(n<=0||o<=0)return{total:0};const s=t.layer_mode||U.MAIN,a=s===U.MAIN||s===U.DOUBLE,i=s===U.SHEER||s===U.DOUBLE;let l=0,u=0;if(a){const P=y(t.price_per_m_raw);l=n*P}if(i){const P=y(t.sheer_price_per_m);u=n*P}let f=0,h=0;a&&(f=ot(n,t.style,t.opening_style,r?.formulas)),i&&(h=ot(n,t.style,t.opening_style,r?.formulas));const b=l+u+0+0;return{total:Math.round(b*100)/100,breakdown:{fabricPrice:l,sheerPrice:u,fabricYards:f,sheerYards:h,fabricMeters:n,sheerMeters:i?n:0}}},validate:t=>{const r=[];return y(t.width_m)<=0&&r.push("‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á"),y(t.height_m)<=0&&r.push("‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á"),t.style||r.push("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏°‡πà‡∏≤‡∏ô"),r},getSpecs:t=>{const r=[`‡∏Å‡∏ß‡πâ‡∏≤‡∏á ${t.width_m} x ‡∏™‡∏π‡∏á ${t.height_m} ‡∏°.`,t.style];return t.opening_style&&r.push(`(${t.opening_style})`),t.layer_mode===U.DOUBLE&&r.push("‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö+‡πÇ‡∏õ‡∏£‡πà‡∏á"),r}},at={calculate:(t,r)=>{const n=t.widths.reduce((P,S)=>P+y(S),0),o=y(t.height_m);if(n<=0||o<=0)return{total:0,breakdown:{}};const a=(r?.formulas||j.getState().formulas).wallpaper,i=o+a.waste_margin,l=Math.floor(a.roll_length/i);let u=0;if(l>0){const P=Math.ceil(n/a.roll_width);u=Math.ceil(P/l)}else u=0;const f=y(t.price_per_roll),h=y(t.install_cost_per_roll),R=u*f,I=u*h;let b=R+I;return t.enable_set_price&&y(t.set_price_override)>0&&(b=y(t.set_price_override)),b=Math.round(b*100)/100,{total:b,breakdown:{rolls:u,materialPrice:R,laborPrice:I,totalWidth:n}}},validate:t=>{const r=[];return t.widths.reduce((o,s)=>o+y(s),0)<=0&&r.push("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏ú‡∏ô‡∏±‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏î‡πâ‡∏≤‡∏ô"),y(t.height_m)<=0&&r.push("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏ú‡∏ô‡∏±‡∏á"),t.wallpaper_code||r.push("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏≠‡∏•‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå"),r},getSpecs:t=>{const r=t.widths.reduce((l,u)=>l+y(u),0),n=[`‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏£‡∏ß‡∏° ${r.toFixed(2)} ‡∏°. x ‡∏™‡∏π‡∏á ${t.height_m} ‡∏°.`];t.wallpaper_code&&n.push(`‡∏£‡∏´‡∏±‡∏™: ${t.wallpaper_code}`);const{formulas:o}=j.getState(),s=o.wallpaper,a=y(t.height_m);let i=0;if(a>0&&r>0){const l=a+s.waste_margin,u=Math.floor(s.roll_length/l);if(u>0){const f=Math.ceil(r/s.roll_width);i=Math.ceil(f/u)}}return n.push(`‡πÉ‡∏ä‡πâ: ${i} ‡∏°‡πâ‡∏ß‡∏ô (‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)`),n}},ct={calculate:t=>{if(t.enable_set_price&&y(t.set_price_override)>0)return{total:y(t.set_price_override)};const r=y(t.quantity),n=y(t.price_per_item);if(r<=0||n<=0)return{total:0};const o=r*n;return{total:Math.round(o*100)/100}},validate:t=>{const r=[];return t.description||r.push("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô"),!t.enable_set_price&&y(t.price_per_item)<=0&&r.push("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢"),r},getSpecs:t=>{const r=[];t.description&&r.push(t.description);const n=y(t.quantity);return n>0&&r.push(`‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${n} ‡∏à‡∏∏‡∏î/‡∏ä‡∏∏‡∏î`),r}},D=t=>({calculate:(r,n)=>{if(r.enable_set_price&&y(r.set_price_override)>0)return{total:y(r.set_price_override)};const o=y(r.width_m),s=y(r.height_m),a=y(r.price_sqyd);if(o<=0||s<=0)return{total:0,breakdown:{}};const l=(n?.formulas||j.getState().formulas).area,u=o*s,f=l?.sqm_to_sqyd??1.2;let h=u*f;const R=l?.min_yield??1;h<R&&(h=R);let I=h*a;return I=Math.round(I*100)/100,{total:I,breakdown:{areaSqm:u,areaSqyd:h,pricePerUnit:a}}},validate:r=>{const n=[];return y(r.width_m)<=0&&n.push("‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á"),y(r.height_m)<=0&&n.push("‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á"),!r.enable_set_price&&y(r.price_sqyd)<=0&&n.push("‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠ ‡∏ï‡∏£.‡∏•."),n},getSpecs:r=>{const n=[`‡∏Ç‡∏ô‡∏≤‡∏î: ${r.width_m} x ${r.height_m} ‡∏°.`];return r.code&&n.push(`‡∏£‡∏´‡∏±‡∏™: ${r.code}`),r.fabric_variant&&n.push(`‡∏£‡∏∏‡πà‡∏ô/‡∏™‡∏µ: ${r.fabric_variant}`),r.adjustment_side&&n.push(`‡∏õ‡∏£‡∏±‡∏ö: ${r.adjustment_side}`),n}}),ut=D(),it=D(),lt=D(),ft=D(),pt=D(),dt=D(),_t={calculatePrice:(t,r)=>{const n=_t.calculateDetailedPrice(t,r).total;return Number.isFinite(n)?n:0},calculateDetailedPrice:(t,r)=>{if(!t||!t.type)return{total:0};try{switch(t.type){case E.CURTAIN:return st.calculate(t,r);case E.WALLPAPER:return at.calculate(t,r);case E.WOODEN_BLIND:return ut.calculate(t,r);case E.ROLLER_BLIND:return it.calculate(t,r);case E.VERTICAL_BLIND:return lt.calculate(t,r);case E.ALUMINUM_BLIND:return ft.calculate(t,r);case E.PARTITION:return pt.calculate(t,r);case E.PLEATED_SCREEN:return dt.calculate(t,r);case E.REMOVAL:return ct.calculate(t,r);default:return console.warn("[PricingEngine] ‚ö†Ô∏è Unknown item type detected:",t),{total:0}}}catch(n){return console.error("[PricingEngine] üí• Critical Calculation Error:",n),{total:0}}},getItemSpecs:t=>{if(!t||!t.type)return[];try{switch(t.type){case E.CURTAIN:return st.getSpecs(t);case E.WALLPAPER:return at.getSpecs(t);case E.WOODEN_BLIND:return ut.getSpecs(t);case E.ROLLER_BLIND:return it.getSpecs(t);case E.VERTICAL_BLIND:return lt.getSpecs(t);case E.ALUMINUM_BLIND:return ft.getSpecs(t);case E.PARTITION:return pt.getSpecs(t);case E.PLEATED_SCREEN:return dt.getSpecs(t);case E.REMOVAL:return ct.getSpecs(t);default:return[]}}catch{return["Error generating specs"]}}};self.onmessage=t=>{const{id:r,items:n,context:o}=t.data;try{const s=n.map(i=>({itemId:i.id,total:_t.calculatePrice(i,o)})),a={id:r,results:s};self.postMessage(a)}catch(s){console.error("Worker Calculation Error:",s),self.postMessage({id:r,results:[],error:s instanceof Error?s.message:"Unknown worker error"})}}})();
